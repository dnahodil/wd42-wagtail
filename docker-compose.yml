version: '2.3'

services:
  frontend:
    build:
      context: .
      dockerfile: Dockerfile
      target: frontend

    volumes:
      - './dev42/frontend:/app/frontend'
      - './dev42/static:/app/static'

  backend: &backend
    build:
      context: .
      dockerfile: Dockerfile
      target: backend

    command: ./manage.py runserver 0.0.0.0:8000

    ports:
      - '80:8000'

    volumes:
      - './dev42:/app/dev42'
      - './tests:/app/tests'
      - './data/:/app/data/'
      - './deploy:/app/deploy/'
      - './dev/settings.py:/app/devsettings.py'
      - './manage.py:/app/manage.py'

    environment:
      - 'DJANGO_SETTINGS_MODULE=devsettings'

    depends_on:
      - database

    links:
      - mail
      - frontend

  database:
    image: postgres

  mail:
    image: djfarrelly/maildev
    ports:
      - "9000:80"
